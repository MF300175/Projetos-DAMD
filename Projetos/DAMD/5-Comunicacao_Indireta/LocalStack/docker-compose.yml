version: "3.8"

services:
  localstack:
    image: localstack/localstack:latest
    container_name: localstack
    ports:
      - "${LOCALSTACK_PORT:-4566}:4566"
    environment:
      - SERVICES=s3
      - EDGE_PORT=4566
      - AWS_DEFAULT_REGION=${AWS_REGION:-us-east-1}
      - DEBUG=1
    volumes:
      - localstack_data:/var/lib/localstack

  backend-aws:
    build: ./backend-aws
    container_name: backend-aws
    depends_on:
      - localstack
    environment:
      - PORT=${BACKEND_AWS_PORT:-3001}
      - DB_PATH=/data/database-cloud.db
      - AWS_REGION=${AWS_REGION:-us-east-1}
      - AWS_S3_BUCKET=${AWS_S3_BUCKET:-shopping-images}
      - AWS_ENDPOINT=http://localstack:4566
      - NODE_ENV=development
    ports:
      - "${BACKEND_AWS_PORT:-3001}:3001"
    volumes:
      - backend_aws_data:/data

volumes:
  localstack_data:
  backend_aws_data:



